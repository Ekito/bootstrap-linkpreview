(function(e){var t=function(t,n){if(n===null||n.url===null)return;this.$element=e(t);this.$previewContainer=e(n.previewContainer);this.url=n.url;this.init()};t.prototype={constructor:t,url:null,$element:null,$previewContainer:null,init:function(){this.getSource(this.url,this.renderPreview,this.renderError)},getSource:function(t,n,r){e.ajax({url:t,type:"GET",context:this,success:n,error:r})},renderPreview:function(t){console.log(t);t=t.replace(/<\/?[A-Z]+[\w\W]*?>/g,function(e){return e.toLowerCase()});var n=document.implementation.createHTMLDocument("");n.body.innerHTML=t;var r=e(n),i=this.findTitleInDom(r),s=this.findDescriptionInDom(r),o=this.findImageInDom(r),u=e("<h4></h4>").text(i),a=e("<p></p>").text(s),f=e("<img></img>").attr("src",o);if(this.$previewContainer.length)this.$previewContainer.append(u).append(a).append(f);else{u.insertAfter(this.$element);a.insertAfter(u);f.insertAfter(a)}},renderError:function(e){console.log("ERROR");console.log(e)},findTitleInDom:function(e){return e.find("title").text()||e.find("meta[name=title]").attr("content")},findDescriptionInDom:function(e){return e.find("meta[name=description]").attr("content")},findImageInDom:function(e){var t=e.find("meta[itemprop=image]").attr("content")||e.find("link[rel=image_src]").attr("content")||e.find("meta[itemprop=image]").attr("content")||this.findFirstImageInBody(e.find("body"));if(t&&!this.validateUrl(t)){var n=document.createElement("a");n.href=this.url;t=n.protocol+"//"+n.hostname+t}return t},findFirstImageInBody:function(t){var n,r=t.find("img[src]"),i;r.each(function(){i=e(this);if(i.attr("height")&&i.attr("width")){n=this.src;return!1}});return n},validateUrl:function(e){return/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}};e.fn.linkpreview=function(n){return this.each(function(){var r=e(this),i=r.data("linkpreview"),s=typeof n=="object"&&n;i||r.data("linkpreview",i=new t(this,e.extend({},e.fn.linkpreview.defaults,s)));typeof n=="string"&&i[n]()})};e.fn.linkpreview.defaults={};e.fn.linkpreview.Constructor=t})(window.jQuery);